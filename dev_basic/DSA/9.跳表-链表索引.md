# 跳表

因为链表不能使用二分查找，所以对链表进行改造，增加索引层，使其支持类似的二分查找。

索引创建的方法是每两个节点，提取一个节点到上一层，抽取的这一层就是索引层。索引层有一个down指针，指向下一级节点。这样，在索引层遍历就可以节省一半时间。

```
一级索引 1====>4====>6====>8====>10=====>18
        |     |     |     |     |       |
原始链表 1--3--4--5--6--7--8--9--10--13--18--20
```

如果要查找 9 则只需要遍历 1-4-6-8-(down)->8-9 即可，相对原始链表的遍历可以节省非常多的时间按。

可以添加多级索引，这样可以显著提升查询效率。

## 跳表的查询速度

单链表的查询时间复杂度是O(n)，跳表第一级大约是n/2，第二级大约是n/4，等差数列求和，则k级索引的节点个数是n/(2^k)。如果有 h 级索引，则 h=log_{2}n-1。如果每层遍历 m 个节点，则跳表查询数据的时间复杂度是O(m*logn)。

一层最多遍历 m 次，这个 m 的值最大为 3，包括：

1. 上一层的down指针
2. 这一层的第一个数据检查
3. 下一个数据检查
- 确认数据是不是这两个之间还是大于第二个数据，决定是从第一个向下down还是第二个向下down。

## 跳表是不是很浪费内存

如果每两个节点抽1个作为索引，那么 n 个节点的单链表构造的跳表，需要额外再接近 n 个节点的存储空间。

如果需要减少，可以考虑每 3 个节点抽 1 个作为索引，这样可以比 2 个节点的节省一半。


## 动态插入和删除

由于单链表只要找到插入点，插入操作都是O(1)所以时间复杂度和查找啊相同O(logn)。

## 索引动态更新

如果一直在某两个索引之间插入，可能这个地方数据会非常多，然会就会退化成一般的单链表了。

可以在插入数据的时候，选择同时将这个数据插入到部分索引层中。Redis 使用随机函数来生成 K，这个 K 就是要将这个节点添加到第一级到第 K 级索引中。这个随机函数需要从概率上保证跳表的索引大小和数据大小平衡性。
